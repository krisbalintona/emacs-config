#+TITLE: Spelling and grammar checking

* Spell checking

General ispell settings
#+begin_src emacs-lisp
  (ispell-program-name "/usr/bin/aspell") ; Use aspell
  (ispell-dictionary "en_US")
#+end_src

** Spell-fu

Fast spell checking
#+BEGIN_SRC emacs-lisp
  (use-package spell-fu
    :disabled t ; Testing flyspell for now
    :hook
    ((text-mode . spell-fu-mode)
     (spell-fu-mode . (lambda () ; Change personal dictionary
                        (setq ispell-personal-dictionary (concat spell-fu-directory "spell-fu-ispell-personal-dict-en"))
                        ))
     )
    :custom
    (spell-fu-idle-delay 0.6)
    (spell-fu-directory (concat no-littering-var-directory "spell-fu/"))
    :config
    (kb/leader-keys
      "ts" '(spell-fu-mode :which-key "Toggle spell-fu")
      "ta" '(spell-fu-word-add :which-key "Spell-fu-word-add")
      )
    )
#+END_SRC

** Flyspell

*** Flyspell itself

#+begin_src emacs-lisp
  (use-package flyspell
    :hook
    ((text-mode . flyspell-mode)
     (prog-mode . flyspell-prog-mode)
     (flyspell-mode . (lambda () ; Change personal dictionary
                        (setq ispell-personal-dictionary (concat no-littering-var-directory "flyspell/flyspell-ispell-personal-dict-en"))
                        ))
     )
    :custom
    (flyspell-issue-message-flag nil) ; Disable to prevent massive slowdown
    )
#+end_src

*** Flyspell-lazy

Check on idle instead of instantly
#+begin_src emacs-lisp
  (use-package flyspell-lazy
    :after flyspell
    :hook (flyspell-mode . flyspell-lazy-mode)
    :custom
    (flyspell-lazy-changes-threshold 100) ; Force check if this many changes are pending
    (flyspell-lazy-idle-seconds 2)
    (flyspell-lazy-window-idle-seconds 15)
    (flyspell-lazy-use-flyspell-word t) ; Immediately recheck when leaving a marked word
    )
#+end_src

*** Flyspell-correct

Suggest correct spelling for words flyspell marks as incorrect
#+begin_src emacs-lisp
  (use-package flyspell-correct
    :after flyspell
    :config
    (kb/leader-keys
      "tf" '(flyspell-correct-wrapper :which-key "Flyspell")
      )
    )
#+end_src

*** Flyspell-correct-ivy

Flyspell-correct interface via Ivy
#+begin_src emacs-lisp
  (use-package flyspell-correct-ivy
    :after flyspell-correct
    )
#+end_src

* Grammar

** Writegood-mode

Catch weasel words
#+begin_src emacs-lisp
  (use-package writegood-mode
    :disabled t ; Not necessary anymore with proselint syntax checker in flycheck
    :hook (text-mode . writegood-mode)
    )
#+end_src

** Langtool

#+begin_src emacs-lisp
  (use-package langtool
    :custom
    (langtool-default-language "en-US")
    (langtool-java-classpath "/usr/share/languagetool:/usr/share/java/languagetool/*")
    (langtool-autoshow-message-function 'langtool-autoshow-detail-popup)
    :preface
    (defun langtool-autoshow-detail-popup (overlays)
      (when (require 'popup nil t)
        ;; Do not interrupt current popup
        (unless (or popup-instances
                    ;; suppress popup after type `C-g` .
                    (memq last-command '(keyboard-quit)))
          (let ((msg (langtool-details-error-message overlays)))
            (popup-tip msg)))))
    :config
    (pretty-hydra-define hydra:langtool
      (:color green :hint t :foreign-keys run :quit-key "q" :exit t)
      ("Correct grammar"
       (("b" #'langtool-check-buffer "Check")
        ("c" #'langtool-correct-buffer "Correct")
        ("d" #'langtool-check-done "Done"))
       ))

    (general-define-key
     "C-c L" '(hydra:langtool/body :which-key "Langtool")
     )
    )
#+end_src

* Online

** Define-word

See definitions within Emacs
 - Offline version is [[https://github.com/gromnitsky/wordnut][wordnut]]
#+BEGIN_SRC emacs-lisp
  (use-package define-word
    :config
    (global-set-key (kbd "C-c d") 'define-word-at-point)
    (global-set-key (kbd "C-c D") 'define-word)
    )
#+END_SRC

** Google-translate

Translate strings via Google Translate
#+begin_src emacs-lisp
  (use-package google-translate
    :config
    (general-define-key "C-c t" '(google-translate-smooth-translate :which-key "Google translate"))
    )
#+end_src

** Powerthesaurus

Insert or search words in thesaurus
 - Offline version is [[https://github.com/hpdeifel/synosaurus][synosaurus]]
#+BEGIN_SRC emacs-lisp
  (use-package powerthesaurus
    :config
    (global-set-key (kbd "C-c l") 'powerthesaurus-lookup-word-dwim)
    )
#+END_SRC
